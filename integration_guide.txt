## ğŸ”Œ é›†æˆæŒ‡å— (Integration Guide)

ä¸ºç¡®ä¿ **å®ç›˜ = å›æµ‹**ï¼Œæ‚¨çš„å¼•æ“å¿…é¡»æŒ‰ç…§ä»¥ä¸‹è§„èŒƒæä¾›æ•°æ®å’Œè°ƒç”¨ Agentã€‚

### 1. æ•°æ®è¾“å…¥è¦æ±‚ (Data Input Specification)

Agent éœ€è¦æ¥æ”¶ `ModelInput` å¯¹è±¡ï¼Œå…¶ä¸­ `history_candles` æ˜¯å…³é”®ï¼š

| å­—æ®µ | ç±»å‹ | è¦æ±‚ | å¤‡æ³¨ |
|------|------|------|------|
| `datetime` | `datetime` | **å¿…é¡»** | Kçº¿æ—¶é—´æˆ³ (UTC) |
| `open` | `float` | **å¿…é¡»** | å¼€ç›˜ä»· |
| `high` | `float` | **å¿…é¡»** | æœ€é«˜ä»· |
| `low` | `float` | **å¿…é¡»** | æœ€ä½ä»· |
| `close` | `float` | **å¿…é¡»** | æ”¶ç›˜ä»· |
| `volume` | `float` | å¯é€‰ | æˆäº¤é‡ |

**æ•°æ®é‡è¦æ±‚**: è‡³å°‘æä¾› **200 æ ¹ M15 Kçº¿** (çº¦ 50 å°æ—¶)ã€‚ä¸è¶³ 200 æ ¹æ—¶ï¼ŒAgent è¿”å› `HOLD`ã€‚

### 2. è°ƒç”¨æ¥å£ (API Interface)

```python
from agent import TradingAgent, ModelInput

# 1. åˆå§‹åŒ–
agent = TradingAgent(bundle_dir="path/to/agent_bundle_alpha_prime")

# 2. æ„é€ è¾“å…¥
model_input = ModelInput(
    timestamp=current_time,
    symbol="XAUUSD",
    timeframe="M15",
    price=current_close,            # å½“å‰ Close
    history_candles=df_m15_history, # DataFrame, è‡³å°‘ 200 è¡Œ
    candle={"o":..., "h":..., "l":..., "c":...},
    position=0,                     # 0=Flat, 1=Long, -1=Short
    bars_held=0,
    open_trades=0,
    entry_price=0.0,                # å¦‚æœæœ‰æŒä»“ï¼Œå¡«å…¥å¼€ä»“ä»·
    daily_pnl=0.0,
    daily_drawdown=0.0,
    equity=10000.0,                 # å½“å‰å‡€å€¼
    balance=10000.0,
    meta={}
)

# 3. è·å–ä¿¡å·
output = agent.predict_from_input(model_input)

# 4. è§£æè¾“å‡º
print(output.signal)     # "BUY" / "SELL" / "HOLD"
print(output.size)       # å»ºè®®æ‰‹æ•° (ç”± risk_manager è®¡ç®—)
print(output.sl)         # æ­¢æŸä»· (å¿…é¡»è®¾ç½®ï¼äº¤ç»™åˆ¸å•†æ‰§è¡Œ)
print(output.tag)        # ä¿¡å·æ ‡ç­¾, å¦‚ "V5_TREND_LONG"
```

### 3. å…³é”®ä¸€è‡´æ€§ä¿è¯ (Parity Checklist)

| é¡¹ç›® | å›æµ‹å®ç° | å®ç›˜è¦æ±‚ | é‡è¦æ€§ |
|------|----------|----------|--------|
| **Kçº¿ç²’åº¦** | M15 | **å¿…é¡» M15** | ğŸ”´ è‡´å‘½ |
| **æ—¶åŒº** | UTC | **å¿…é¡» UTC** | ğŸ”´ è‡´å‘½ |
| **H1 Trend è®¡ç®—** | Bundle å†…ç½® (`shift(1)`) | æ— éœ€å¤–éƒ¨æä¾› | âœ… è‡ªç»™è‡ªè¶³ |
| **ATR è®¡ç®—** | Bundle å†…ç½® | æ— éœ€å¤–éƒ¨æä¾› | âœ… è‡ªç»™è‡ªè¶³ |
| **æ­¢æŸæ‰§è¡Œ** | å›æµ‹ç”¨ Low/High æ£€æµ‹ | **åˆ¸å•†æ‰§è¡Œ** (Agent åªæä¾› `sl` ä»·æ ¼) | ğŸŸ¡ ä¾èµ–åˆ¸å•† |
| **ä»“ä½ç®¡ç†** | `0.1 Lot / $10k` | Agent è‡ªåŠ¨è®¡ç®—, ä½†å¼•æ“å¯è¦†ç›– | ğŸŸ¡ å¯è°ƒ |

### 4. å¸¸è§é”™è¯¯ (Common Mistakes)

| é”™è¯¯ | åæœ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| æä¾› M1 æ•°æ® | æŒ‡æ ‡è®¡ç®—é”™è¯¯ | è½¬æ¢ä¸º M15 |
| æä¾› < 200 æ ¹ Kçº¿ | Agent è¿”å› HOLD | å¢åŠ å†å²æ·±åº¦ |
| ä¸è®¾ç½® SL | æ— é™äºæŸ | å¿…é¡»æŠŠ `output.sl` ä¼ ç»™åˆ¸å•† |
| æ—¶åŒºæ··ä¹± (æœ¬åœ°æ—¶é—´) | H1 Trend / Session é”™è¯¯ | ç»Ÿä¸€ UTC |
| æ‰‹åŠ¨è¦†ç›– signal | å›æµ‹ä¸å®ç›˜ä¸ä¸€è‡´ | ä¸¥æ ¼æ‰§è¡Œ Agent ä¿¡å· |

---

## ğŸ›‘ Final Governance Protocol